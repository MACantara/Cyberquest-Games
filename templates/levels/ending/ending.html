{% extends "base.html" %}
{% block content %}
<!-- Ending: The Sentinel's Legacy -->
<div class="max-w-7xl mx-auto">
    <!-- Opening Sequence Modal -->
    <div id="ending-intro-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-8 max-w-3xl mx-4">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">üõ°Ô∏è</div>
                <h2 class="text-3xl font-bold text-cyan-300 mb-4">Mission Complete</h2>
                <div class="bg-green-900 border border-green-600 rounded p-4 mb-4">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="bi bi-check-circle text-green-400 text-xl"></i>
                        <span class="font-semibold text-green-300">THE NULL DISMANTLED</span>
                    </div>
                    <p class="text-green-200 text-sm">
                        The shadowy organization has been exposed and their network dismantled. Dr. Alexis Reeves has
                        been taken into custody for questioning.
                    </p>
                </div>
                <div class="bg-purple-900 border border-purple-600 rounded p-4 mb-4">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="bi bi-scales text-purple-400 text-xl"></i>
                        <span class="font-semibold text-purple-300">ETHICAL QUESTIONS REMAIN</span>
                    </div>
                    <p class="text-purple-200 text-sm">
                        But the investigation has revealed uncomfortable truths about the Academy itself. A Senate-like
                        digital ethics board has convened to review your actions and the Academy's future.
                    </p>
                </div>
                <div class="bg-gray-700 rounded p-4 mb-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="bg-purple-600 rounded-full w-8 h-8 flex items-center justify-center">
                            <i class="bi bi-person-badge text-white text-sm"></i>
                        </div>
                        <span class="font-semibold text-purple-300">Commander Vega</span>
                    </div>
                    <p class="text-gray-200 text-sm italic">
                        "This wasn't just a mission, Nova. It was a mirror. Now we must face what we've seen and decide
                        what we'll do with that knowledge."
                    </p>
                </div>
            </div>
            <button id="begin-debrief"
                class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded">
                Begin Final Debrief
            </button>
        </div>
    </div>

    <!-- Header -->
    <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
                <i class="bi bi-award text-gold-400 text-3xl"></i>
                <div>
                    <h1 class="text-2xl font-bold text-cyan-300">The Sentinel's Legacy</h1>
                    <p class="text-gray-300">Academy Debrief Chamber - Final Assessment</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-sm text-gray-400">Academy Rank</div>
                <div class="text-lg font-semibold text-gold-400">Cyber Sentinel - First Class</div>
            </div>
        </div>

        <!-- Final Stats -->
        <div class="grid grid-cols-4 gap-4 bg-gray-700 rounded p-4">
            <div class="text-center">
                <div class="text-2xl font-bold text-green-400" id="missions-completed">10</div>
                <div class="text-xs text-gray-400">Missions Completed</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-400" id="ethical-score">95</div>
                <div class="text-xs text-gray-400">Ethical Score (%)</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-400" id="threats-neutralized">127</div>
                <div class="text-xs text-gray-400">Threats Neutralized</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-yellow-400" id="lives-protected">50000</div>
                <div class="text-xs text-gray-400">Lives Protected</div>
            </div>
        </div>
    </div>

    <!-- Main Interface -->
    <div class="grid grid-cols-12 gap-6">
        <!-- Left Panel: Memory Wall -->
        <div class="col-span-4 bg-gray-800 rounded-lg p-4 shadow">
            <h3 class="text-lg font-semibold text-cyan-300 mb-4 flex items-center gap-2">
                <i class="bi bi-clock-history"></i> Memory Wall
            </h3>

            <div class="space-y-3 max-h-96 overflow-y-auto">
                <!-- Mission 1 Memory -->
                <div class="memory-item bg-blue-900 border border-blue-600 rounded p-3 cursor-pointer hover:bg-blue-800 transition"
                    data-mission="1">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-newspaper text-yellow-400 text-lg flex-shrink-0 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-white">Misinformation Maze</h4>
                            <p class="text-xs text-blue-300 mb-1">Verified 12 news sources</p>
                            <div class="text-xs text-green-400">‚úì Prevented election interference</div>
                        </div>
                    </div>
                </div>

                <!-- Mission 2 Memory -->
                <div class="memory-item bg-red-900 border border-red-600 rounded p-3 cursor-pointer hover:bg-red-800 transition"
                    data-mission="2">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-envelope-exclamation text-red-400 text-lg flex-shrink-0 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-white">Shadow in the Inbox</h4>
                            <p class="text-xs text-red-300 mb-1">Identified 8 phishing attempts</p>
                            <div class="text-xs text-green-400">‚úì Protected student credentials</div>
                        </div>
                    </div>
                </div>

                <!-- Mission 3 Memory -->
                <div class="memory-item bg-purple-900 border border-purple-600 rounded p-3 cursor-pointer hover:bg-purple-800 transition"
                    data-mission="3">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-bug text-purple-400 text-lg flex-shrink-0 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-white">Malware Mayhem</h4>
                            <p class="text-xs text-purple-300 mb-1">Quarantined 15 infected systems</p>
                            <div class="text-xs text-green-400">‚úì Saved gaming tournament</div>
                        </div>
                    </div>
                </div>

                <!-- Mission 8 Memory -->
                <div class="memory-item bg-emerald-900 border border-emerald-600 rounded p-3 cursor-pointer hover:bg-emerald-800 transition"
                    data-mission="8">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-shield-check text-emerald-400 text-lg flex-shrink-0 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-white">The White Hat Test</h4>
                            <p class="text-xs text-emerald-300 mb-1">Responsible vulnerability disclosure</p>
                            <div class="text-xs text-green-400">‚úì Maintained ethical integrity</div>
                        </div>
                    </div>
                </div>

                <!-- Mission 10 Memory -->
                <div class="memory-item bg-indigo-900 border border-indigo-600 rounded p-3 cursor-pointer hover:bg-indigo-800 transition"
                    data-mission="10">
                    <div class="flex items-start gap-3">
                        <i class="bi bi-search text-indigo-400 text-lg flex-shrink-0 mt-1"></i>
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-white">Hunt for The Null</h4>
                            <p class="text-xs text-indigo-300 mb-1">Identified Dr. Reeves as mastermind</p>
                            <div class="text-xs text-green-400">‚úì Exposed the truth</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Interactive Debrief -->
        <div class="col-span-5 bg-gray-800 rounded-lg p-4 shadow">
            <h3 class="text-lg font-semibold text-cyan-300 mb-4 flex items-center gap-2">
                <i class="bi bi-file-earmark-text"></i> Sentinel Report
            </h3>

            <!-- Default State -->
            <div id="report-intro" class="bg-gray-700 rounded p-6 text-center">
                <i class="bi bi-clipboard-data text-4xl text-gray-500 mb-4"></i>
                <h4 class="text-xl font-semibold text-white mb-2">Academy Debrief Protocol</h4>
                <p class="text-gray-300 mb-4">
                    Review your journey, reflect on key decisions, and help shape the Academy's future.
                </p>
                <button id="start-debrief"
                    class="bg-cyan-500 hover:bg-cyan-600 text-white px-6 py-3 rounded font-medium">
                    Begin Debrief Session
                </button>
            </div>

            <!-- Debrief Sections -->
            <div id="debrief-content" class="hidden space-y-4">
                <!-- Section 1: Decision Review -->
                <div id="decision-review" class="bg-gray-700 rounded p-4">
                    <h4 class="text-lg font-semibold text-white mb-3">Key Decision Analysis</h4>
                    <div class="space-y-3">
                        <div class="decision-item bg-gray-600 rounded p-3">
                            <h5 class="text-cyan-300 font-semibold mb-2">Level 8: Vulnerability Disclosure</h5>
                            <p class="text-gray-300 text-sm mb-2">You chose responsible disclosure over selling to the
                                black
                                market.</p>
                            <div class="flex items-center gap-2">
                                <span class="text-green-400 text-sm">‚úì Ethical choice</span>
                                <span class="text-gray-400 text-xs">- 82% of players made the same decision</span>
                            </div>
                        </div>

                        <div class="decision-item bg-gray-600 rounded p-3">
                            <h5 class="text-cyan-300 font-semibold mb-2">Level 9: Infrastructure Priority</h5>
                            <p class="text-gray-300 text-sm mb-2">You prioritized hospital systems over traffic control
                                during the DDoS attack.</p>
                            <div class="flex items-center gap-2">
                                <span class="text-green-400 text-sm">‚úì Lives over convenience</span>
                                <span class="text-gray-400 text-xs">- 94% of players made the same decision</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Reflection Questions -->
                <div id="reflection-questions" class="bg-gray-700 rounded p-4">
                    <h4 class="text-lg font-semibold text-white mb-3">Personal Reflection</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-cyan-300 text-sm font-semibold mb-2">What was your most challenging
                                ethical decision?</label>
                            <textarea id="challenge-reflection"
                                class="w-full bg-gray-600 text-white p-3 rounded text-sm border border-gray-500"
                                rows="3" placeholder="Reflect on the moments that tested your values..."></textarea>
                        </div>

                        <div>
                            <label class="block text-cyan-300 text-sm font-semibold mb-2">How will you apply these
                                lessons
                                in real life?</label>
                            <textarea id="application-reflection"
                                class="w-full bg-gray-600 text-white p-3 rounded text-sm border border-gray-500"
                                rows="3"
                                placeholder="Consider how cybersecurity awareness impacts your daily digital life..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Academy Reform -->
                <div id="academy-reform" class="bg-purple-900 border border-purple-600 rounded p-4">
                    <h4 class="text-lg font-semibold text-purple-300 mb-3">Academy Reform Recommendations</h4>
                    <p class="text-purple-200 text-sm mb-3">Based on your investigation, what changes should the Academy
                        implement?</p>
                    <div class="space-y-2">
                        <label class="flex items-start gap-3">
                            <input type="checkbox" class="reform-checkbox mt-1" value="transparency">
                            <span class="text-purple-200 text-sm">Increase transparency in research programs</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" class="reform-checkbox mt-1" value="oversight">
                            <span class="text-purple-200 text-sm">Establish independent ethics oversight
                                committee</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" class="reform-checkbox mt-1" value="training">
                            <span class="text-purple-200 text-sm">Mandatory ethics training for all staff</span>
                        </label>
                        <label class="flex items-start gap-3">
                            <input type="checkbox" class="reform-checkbox mt-1" value="whistleblower">
                            <span class="text-purple-200 text-sm">Protected whistleblower channels</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Legacy & Future -->
        <div class="col-span-3 space-y-4">
            <!-- Digital Badge -->
            <div class="bg-gradient-to-br from-gold-600 to-yellow-600 rounded-lg p-4 shadow">
                <div class="text-center">
                    <div class="text-4xl mb-2">üèÜ</div>
                    <h3 class="text-lg font-semibold text-white mb-2">Cyber Sentinel</h3>
                    <p class="text-yellow-100 text-sm mb-3">First Class</p>
                    <div class="bg-black bg-opacity-30 rounded p-2">
                        <p class="text-yellow-200 text-xs">Academy Serial: CS-2024-001</p>
                        <p class="text-yellow-200 text-xs">Cadet Nova</p>
                    </div>
                </div>
            </div>

            <!-- Ethics Board Verdict -->
            <div class="bg-gray-800 rounded-lg p-4 shadow">
                <h3 class="text-lg font-semibold text-cyan-300 mb-4 flex items-center gap-2">
                    <i class="bi bi-scales"></i> Ethics Board
                </h3>

                <div class="space-y-3">
                    <div class="bg-green-900 border border-green-600 rounded p-3">
                        <h4 class="text-green-300 font-semibold mb-1">Verdict: Commendation</h4>
                        <p class="text-green-200 text-xs">Exceptional ethical conduct throughout crisis</p>
                    </div>

                    <div class="bg-blue-900 border border-blue-600 rounded p-3">
                        <h4 class="text-blue-300 font-semibold mb-1">New Assignment</h4>
                        <p class="text-blue-200 text-xs">Lead Academy Ethics Review Committee</p>
                    </div>
                </div>
            </div>

            <!-- Character Epilogues -->
            <div class="bg-gray-800 rounded-lg p-4 shadow">
                <h3 class="text-lg font-semibold text-cyan-300 mb-4 flex items-center gap-2">
                    <i class="bi bi-people"></i> Where Are They Now?
                </h3>

                <div class="space-y-2 text-xs">
                    <div class="character-epilogue cursor-pointer hover:bg-gray-700 rounded p-2" data-character="vega">
                        <span class="text-purple-300 font-semibold">Commander Vega</span>
                        <p class="text-gray-400">Promoted to Academy Director</p>
                    </div>
                    <div class="character-epilogue cursor-pointer hover:bg-gray-700 rounded p-2" data-character="argus">
                        <span class="text-cyan-300 font-semibold">ARGUS AI</span>
                        <p class="text-gray-400">Upgraded with ethical reasoning protocols</p>
                    </div>
                    <div class="character-epilogue cursor-pointer hover:bg-gray-700 rounded p-2"
                        data-character="reeves">
                        <span class="text-red-300 font-semibold">Dr. Alexis Reeves</span>
                        <p class="text-gray-400">Under investigation, cooperation pending</p>
                    </div>
                </div>
            </div>

            <!-- Personal Motto -->
            <div class="bg-purple-900 border border-purple-600 rounded p-3">
                <h4 class="text-sm font-semibold text-purple-300 mb-2">
                    <i class="bi bi-quote mr-1"></i> Your Motto
                </h4>
                <div class="text-center">
                    <p class="text-purple-200 text-sm italic">"Watch the Watchers"</p>
                    <p class="text-purple-400 text-xs mt-1">Reclaimed from The Null</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="final-message-modal"
        class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-8 max-w-2xl mx-4 text-center">
            <div class="text-6xl mb-4">üåê</div>
            <h2 class="text-2xl font-bold text-cyan-300 mb-4">The Digital Frontier Awaits</h2>
            <div class="bg-gray-700 rounded p-4 mb-6">
                <p class="text-gray-200 text-lg italic mb-4">
                    "Cybersecurity is never truly over. You are now the watcher, the sentinel, the shield between truth
                    and silence."
                </p>
                <p class="text-cyan-400 font-semibold">The Net will remember.</p>
            </div>

            <div class="grid grid-cols-1 gap-3">
                <button id="replay-campaign"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded font-medium">
                    <i class="bi bi-arrow-clockwise mr-2"></i> Replay Campaign
                </button>
                <button id="view-archives"
                    class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded font-medium">
                    <i class="bi bi-archive mr-2"></i> View Academy Archives
                </button>
                <button id="final-logout"
                    class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded font-medium">
                    <i class="bi bi-box-arrow-right mr-2"></i> Log Off
                </button>
            </div>
        </div>
    </div>

    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-8 max-w-lg mx-4">
            <div class="text-center">
                <div id="result-icon" class="text-6xl mb-4"></div>
                <h3 id="result-title" class="text-2xl font-bold mb-4"></h3>
                <div id="result-content" class="text-gray-200 mb-6"></div>
                <button id="close-result"
                    class="bg-cyan-500 hover:bg-cyan-600 text-white px-6 py-3 rounded font-medium">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="mt-8 flex justify-between items-center">
        <a href="{{ url_for('campaign') }}" class="text-cyan-400 hover:underline text-sm flex items-center gap-2">
            <i class="bi bi-arrow-left"></i> Back to Campaign
        </a>
        <button id="complete-debrief"
            class="bg-gold-500 hover:bg-gold-600 text-white px-6 py-3 rounded font-medium disabled:bg-gray-600 disabled:cursor-not-allowed"
            disabled>
            Complete Debrief <i class="bi bi-award ml-2"></i>
        </button>
    </div>
</div>

<!-- Ending JavaScript -->
<script type="module" src="{{ url_for('static', filename='js/levels/ending/ending.js') }}"></script>

<!-- Ending CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/ending.css') }}">
{% endblock %}